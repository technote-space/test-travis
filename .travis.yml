language: php

sudo: false
dist: trusty

notifications:
  email: false
  slack:
    rooms:
      - secure: "XrZGe0s6HIWsMSKBh9gnSOe/Miu9CIOOPWfqaeKe/ccfJI8CbPg2TO/x1JQBdr8njWLkbRqhKbWEnHmxudPw2my4HujtFOLKUnw1t64B6xn7iVv06ie4h6bcHRhdReU5fEsNMKiA43djVrpOl+mY7BvQbI/pLoiqpgF23Rn3aYJd9MnJ/yiy8Mc0jEjZ3Z2MTB458mFT1CVT539sjVkjcv6j3+lqpL1Hajb6bl4XrPjGLcmYkL984YYkGeFtRIlNjijsQWW5g5TTSHwtvoZ1qUlqVWQjF/s+Y6ApNhOPtIp/+SYHi/j4fdEpddi/i3xHhM+rISh35oF3+lCYfDwmc6wRSuwzETYRe0W7psz6uGNgHA+SfLYyGsdaC9Zos32GwtqVMpGuxl5KtPsf6FCfz7Fx9bVnAuYFgF1Minp/SOAlKhrPpZQyJ3fUsB6MitA3NmqZL+cXsrh8ZH6fG02Q3GMErVyZTIsTZSDwdvIF+QtlLlR41ANAhwTNDoln+3rxilxPpgAOq6d2QFZFJ4zCzrbqNIyCtaypdAs2wZY59md87cK19cDrb62G0cf9RJ7YaJlDHzFVvgAcqOtdv3p79AKPhwxnVqGuSfU9eZ0qmr3sLskUomINKws+xuVtS8Q4EVjBkouGP99f+cB67i1Pwhsj/z8ARwGXBbfMUjj43tA="

branches:
  only:
    - master
    - "/^v[0-9\\.]+/"

cache:
  directories:
    - $HOME/.composer/cache
    - $HOME/.npm

stages:
  - name: check
    if: branch = master and tag IS blank and type = pull_request
  - name: test
    if: branch = master and tag IS blank and type = pull_request
  - name: deploy
    if: tag IS present

jobs:
  fast_finish: true
  include:
    - stage: check
      language: php
      php: '7.2'
      script: bash tests/bin/php/phpcs.sh
    - stage: check
      language: php
      php: '7.2'
      script: bash tests/bin/php/phpmd.sh

    - stage: check
      language: node_js
      node_js: '11'
      dist: trusty
      script: bash tests/bin/js/js-lint.sh

#
#    - stage: test
#      language: php
#      php: '7.3'
#      env:
#        - WP_VERSION=latest
#        - COVERAGE_REPORT=1
#      script: bash tests/bin/php/wp-test.sh
#    - stage: test
#      language: php
#      php: '7.3'
#      env:
#        - WP_VERSION=latest
#        - WP_MULTISITE=1
#      script: bash tests/bin/php/wp-test.sh
#    - stage: test
#      language: php
#      php: '7.2'
#      env: WP_VERSION=latest
#      script: bash tests/bin/php/wp-test.sh
#    - stage: test
#      language: php
#      php: '7.2'
#      env:
#        - WP_VERSION=5.2
#        - WP_MULTISITE=1
#        - COVERAGE_REPORT=1
#      script: bash tests/bin/php/wp-test.sh
#    - stage: test
#      language: php
#      php: '7.1'
#      env: WP_VERSION=latest
#      script: bash tests/bin/php/wp-test.sh
#    - stage: test
#      language: php
#      php: '7.1'
#      env:
#        - WP_VERSION=5.1
#        - WP_MULTISITE=1
#        - COVERAGE_REPORT=1
#      script: bash tests/bin/php/wp-test.sh
#    - stage: test
#      language: php
#      php: '7.0'
#      env:
#        - WP_VERSION=5.0
#        - COVERAGE_REPORT=1
#      script: bash tests/bin/php/wp-test.sh
#    - stage: test
#      language: php
#      php: '7.0'
#      env:
#        - WP_VERSION=latest
#        - WP_MULTISITE=1
#      script: bash tests/bin/php/wp-test.sh
#    - stage: test
#      language: php
#      php: '5.6'
#      env:
#        - WP_VERSION=latest
#        - COVERAGE_REPORT=1
#      script: bash tests/bin/php/wp-test.sh
#    - stage: test
#      language: php
#      php: '5.6'
#      env:
#        - WP_VERSION=5.0
#        - WP_MULTISITE=1
#        - COVERAGE_REPORT=1
#      script: bash tests/bin/php/wp-test.sh
#    - stage: test
#      language: php
#      php: '5.6'
#      env: WP_VERSION=trunk
#      script: bash tests/bin/php/wp-test.sh
#    - stage: test
#      language: php
#      php: '5.6'
#      env: WP_VERSION=4.9
#      script: bash tests/bin/php/wp-test.sh
#    - stage: test
#      language: php
#      php: '5.6'
#      env: WP_VERSION=3.9
#      script: bash tests/bin/php/wp-test.sh
#
#    - stage: test
#      language: node_js
#      node_js: '10'
#      dist: trusty
#      script: bash tests/bin/js/js-test.sh
#    - stage: test
#      language: node_js
#      node_js: '11'
#      dist: trusty
#      env: COVERAGE_REPORT=1
#      script: bash tests/bin/js/js-test.sh
#
#
#    - stage: deploy
#      language: node_js
#      node_js: '11'
#      dist: trusty
#      script: skip
#      before_deploy:
#        - source tests/bin/deploy/env.sh
#        - bash tests/bin/deploy/create.sh
#      deploy:
#        provider: releases
#        skip_cleanup: true
#        draft: true
#        api_key:
#          secure: be+VVnNbkweCydikkzwWWtwl8ujtR6U+Q8UG4tghoEyVednJZIo3HQ64gnVO2LpY4xZzw3IzXfcAk9yjaj690khBMZR9tjAXcFuBUSmlkY7YK3fuVfGYD0BuRzUqDVFy+cjvvQQgUYE8iPty9JnRJuSc7RRhgAcQjiZdblLogi02ROgDOKdmriD/4XZQOMpXiqmudicwXWGHC3OyqEIFfEMRZ6Tni4DTQywpVnFU4sOXpYZ3c8Vxb/pTZqbf8wZOvbMxvzWKYL0bfefnPuZxVmoIIBIE38k98lYclUNlyCCY9z9BgEQhgorH/NEosGV+eeMe6U+WLVN9JfOaY2VsJniiMndW7+rq6AklFxetveVczYdN343rQxY8KGX1wFZPYVsVrC6/ZxgvbvIjynl90oID87luDAhseHEBzKo4b6hUCkvmQwQkWf5Mt3d62fNAlbSCTsP4ivON0eXij+EvBqrA4Ax2d17uFLrJUiVuaetCMzW1L1AKTHGRSpE8bD+wrUNCqSTE4fPaJFemA7GAD0A4GiF/dDfJbq6DYgJ//Q6jYwVL4193o41ZyQx2ghdDj5cZg2jKjFtMhrdTvNXTw3CUku9iX0a8CJuTh02VRgnyrOA2p8d9OPLB/xkHF4GDtKfCX78g1NngK14lReModZNHTFYcfHPve0+FCHg2DgE=
#        file: "${RELEASE_FILE}"
#        on:
#          tags: true

#  allow_failures:
#    - env: WP_VERSION=4.9
#    - env: WP_VERSION=3.9
